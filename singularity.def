Bootstrap: docker
From: ubuntu:22.04
Stage: deps

%post
    apt update
    apt install -y --no-install-recommends ca-certificates curl g++ make
    readonly DAGCHAINER_VERSION=r111120
    curl -L https://github.com/kullrich/dagchainer/archive/refs/tags/${DAGCHAINER_VERSION}.tar.gz | tar -xzf -
    cd dagchainer-${DAGCHAINER_VERSION}
    make -j $(nproc) PREFIX=/usr/local/dagchainer
    rm -rf dagchainer-${DAGCHAINER_VERSION}

    curl -Lo /usr/local/bin/famsa https://github.com/refresh-bio/FAMSA/releases/download/v2.1.2/famsa$([ $(uname -m) = aarch64 ] && echo '-arm8')
     

Bootstrap: docker
From: ubuntu:22.04

%files
    *.sh /usr/local/bin
    ./bin /usr/local/

%files from deps
    /usr/local/dagchainer
    /usr/local/bin/famsa

%environment
    export LC_ALL=C
    export PATH=/usr/lib/emboss:/usr/local/dagchainer/bin:/usr/local/dagchainer/bin/accessory_bin:${PATH}

%post
    apt update
    apt install -y --no-install-recommends libbio-perl-perl libparallel-forkmanager-perl mcl mmseqs2 emboss hmmer fasttree
    rm -rf /var/lib/apt/lists/*
    chmod +x /usr/local/bin/*

%runscript
    exec /usr/local/bin/pandagma.sh "$@"
